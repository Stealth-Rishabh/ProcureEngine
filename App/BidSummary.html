<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Sourcing Portal</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all"
          rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet"
          type="text/css" />
    <link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet"
          type="text/css" />
    <link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"
          type="text/css" />
    <link href="assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet"
          type="text/css" />
    <link href="assets/global/plugins/bootstrap-toastr/toastr.css" rel="stylesheet" />
    <link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css"
          rel="stylesheet" type="text/css" />
   
    <link href="assets/global/css/components-md.css" rel="stylesheet" />
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link id="style_color" href="assets/admin/layout/css/themes/default.css" rel="stylesheet"
          type="text/css" />
  
    <link href="assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="../favicon.ico" />
    <style>
        .container {
            height: 95px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        tr, td
        {
            border: 1px solid black;
        }
        tr.header
        {
            cursor:pointer;
        }
    </style>
</head>
<body class="page-header-fixed page-quick-sidebar-over-content page-full-width">
    <div class="page-header navbar navbar-fixed-top">
        <div class="page-header-inner">
            <a class="navbar-brand" href="index.html" style="padding:4px !important;">
                <img src="assets/img/mmlogo.png" alt="logo" class="img-responsive" style="height:38px; width:180px;" />
            </a>
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    <li class="dropdown dropdown-user"><a href="#" class="dropdown-toggle" data-toggle="dropdown"
                        data-hover="dropdown" data-close-others="true"><span id="spanUserName" style="font-weight: bold"
                            class="username username-hide-on-mobile"></span><i class="fa fa-angle-down">
                        </i></a>
                        <ul class="dropdown-menu">
                            <li><a href="MyProfile.html"><i class="icon-user"></i>My Profile </a></li>
                            <li><a href="javascript:;" id="logOut_btn"><i class="fa fa-key"></i>Log Out </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="clearfix">
    </div>
    <div class="page-container">
        <div class="page-content-wrapper">
            <div class="page-content">
                <div class="page-bar">
                    <ul class="page-breadcrumb">
                        <li id="liHome"></li>
                    </ul>
					<!--<div class="page-toolbar">
                        <div id="dashboard-report-range" class="pull-right btn btn-fit-height" >
                            <a href="#HelpModal" data-toggle="modal" class="tooltips btn btn-xs btn-primary" data-placement="left" data-original-title="Click to see help"><i class="fa fa-question-circle"></i> Help</a>
                        </div>
                    </div>-->
                </div>
                <div class="row">
                    <div class="col-md-12 ">
                        <div class="portlet box green-haze">
                            <div class="portlet-title">
                                <div class="caption">

                                    <i class="fa fa-gift"></i>Bid Summary <span class="badge badge-primary" style="font-size: 13px !important;" id="bid_status"></span>
                                   
                                </div><!--
                                <div id="bid_status" class="display-none"></div>-->
                                
                                <div class="tools">
                                    <span id="bid_ConfiguredBy" class="align-right"></span>
                                    <a href="" class="collapse"></a>
                                </div>
                                
                            </div>
                            <div class="portlet-body form" id="content" >
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-md-12 ">
                                            <div class="form-group">
                                                <label class="col-md-1 control-label">
                                                    Bid Subject:
                                                </label>
                                                <label id="lblbidSubject" style="text-align:left" class="col-md-10 control-label">
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12 ">
                                            <div class="form-group">
                                                <label class=" col-md-1 control-label">
                                                    Bid Details:</label>
                                                <!-- <div class="col-md-10"> -->
                                                    <label id="lblbiddetails" style="text-align:justify" class=" col-md-11 control-label">
                                                    </label>
                                                <!-- </div> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label">
                                                    Event ID:</label>
                                                <label class="col-md-6 control-label" id="lblEventID">
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4 ">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label">
                                                    Bid Date/Time:</label>
                                                <label class="col-md-3 control-label" id="lblbiddate">
                                                </label>
                                                <label class="col-md-3 control-label" id="lblbidtime">
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4 ">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label">
                                                    Bid Type:</label>
                                                <label class="col-md-6 control-label" id="lblbidtype">
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 ">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label">
                                                    Bid For:</label>
                                                <label class="col-md-6 control-label" id="lblbidfor">
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4 ">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label ">
                                                    Bid Duration:</label>
                                                <label class="col-md-6 control-label" id="lblbidduration">
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4 ">
                                            <div class="form-control">
                                                <label class="col-md-6 control-label">
                                                    Currency:</label>
                                                <label class="col-md-6 control-label" id="lblcurrency">
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                  
                                    <div id="divTarget" class="form-control hide">
                                        <label class="col-md-2 control-label">
                                            Target Price:
                                        </label>
                                        <label id="lblbidprice" style="display:none">
                                        </label>
                                        <div class="col-md-10" id="divTargetPrice" style="display:none">

                                            <div class="table-responsive" style="overflow: auto; ">
                                                <table class="table table-striped table-bordered table-hover" id="tbltargetPrice">
                                                    <thead>
                                                        <tr><th></th><th>Min</th><th>45+</th><th>100+</th><th>300+</th><th>500+</th><th>1000+</th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>Freight</td>
                                                            <td id="tdfmin"></td>
                                                            <td id="tdf45"></td>
                                                            <td id="tdf100"></td>
                                                            <td id="tdf300"></td>
                                                            <td id="tdf500"></td>
                                                            <td id="tdf1000"></td>
                                                        </tr>
                                                        <tr id="trtargetexworks">
                                                            <td>Ex Work</td>
                                                            <td id="tdxmin"></td>
                                                            <td id="tdx45"></td>
                                                            <td id="tdx100"></td>
                                                            <td id="tdx300"></td>
                                                            <td id="tdx500"></td>
                                                            <td id="tdx1000"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="form-control" id="divModelClass" style="display:none">
                                        <label class="col-md-2 control-label">
                                            Model Class:
                                        </label>
                                        <label class="control-label" id="lblModelClass">
                                        </label>
                                    </div>
                                    <div class="form-control">
                                        <label class="col-md-2 control-label">
                                            Terms & Condition:</label>
                                        
                                        <a id="lnkTermsAttachment" href="javascript:;" onclick="DownloadFile(this)" class="control-label ">No Attachment Found</a>
                                    </div>
                                    <div class="form-control">
                                        <label class="col-md-2 control-label">
                                            Attachment (Any Other):</label>
                                        <a id="lnkAnyOtherAttachment" href="javascript:;" onclick="DownloadFile(this)" class="control-label ">No Attachment Found</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 ">
                        <div class="portlet box blue-hoki">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-gift"></i>Bid Summary
                                </div>
                                <div class="tools">
                                    <a href="" class="collapse"></a>
                                </div>
                                <div class="actions">
                                 <a href="javascript:;" id="lnktotvalue" class="btn red button-submit" >
                                       Detailed Report
                                    </a>                                 
                                                                 
                                </div>
                            </div>
                            <div class="portlet-body form">
                                <div class="table-responsive" style="overflow: auto" id="divforBidsummary">
                                    <table class="table table-bordered hide" id="tbldetails">
                                        <thead>
                                            <tr>
                                                <th>Bid Subject</th>
                                                <th>Bid Description</th>
                                                <th>Bid Time</th>
                                                <th>Bid Type </th>
                                                <th>Bid For</th>
                                                <th>Bid Duration</th>
                                                <th>Currency</th>
                                                <th id="thmodelclass" class="hide">ModelClass</th>
                                                <th id="thtargetprice" class="hide">Target Price</th>
                                            </tr>

                                        </thead>
                                    </table>
                                    <table id="tblprice" class="table table-bordered hide ">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>Min</th>
                                                <th>45+</th>
                                                <th>100+</th>
                                                <th>300+</th>
                                                <th>500+</th>
                                                <th>1000+</th>
                                            </tr>
                                        </thead>
                                    </table>


                                    <table class="table table-bordered" id="tblBidSummary">
                                        <thead>
                                        </thead>
                                        <tbody>

                                            <tr>
                                                <td colspan="15" style="text-align: center; color: Red">
                                                    No record's found
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <div class="table-responsive display-none" style="overflow: auto" id="divfordetailreport">
                                    <table class="table table-bordered valign-center-th" id="tblbidsummarypercentagewise">
                                        <thead>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="15" style="text-align: center; color: Red">
                                                    No record's found
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                   
                                </div>
                                <div class="mt-element-step hide" id="div_statusbar">

                                    
                                    <div class="row step-no-background step-line container" id="divappendstatusbar">

                                    </div>
                                </div>
                                <div class="table-responsive display-none" style="overflow: auto" id="divforapprovalprocess">
                                    <table class="table table-bordered" id="tblapprovalprocess">
                                        <thead>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="15" style="text-align: center; color: Red">
                                                    No record's found
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                   
                                </div>
                                <br />
                                <div class="form-actions fluid" style="padding: 10px 5px;">
                                    <p class="display-none" id="PPrintBy"><label class="pull-left "><b>Print By :&nbsp;&nbsp;</b></label><label id="lblprintByname" class="control-label pull-left"></label></p>
                                    <p class="display-none" id="Pdate"> <label class="pull-right"><b>Date :&nbsp;&nbsp;</b></label><label id="lbldate" class="control-label pull-right"></label></p>
                                    <div class="col-md-offset-3 col-md-6" style="text-align: center">
                                       
                                        <button id="btnExportToExcel" type="button" class="btn blue">
                                            Export To Excel
                                        </button>
                                        <button id="btnpdf" type="button" class="btn green">generate PDF</button>
                                        <a href="#inviteVendorModal" data-toggle="modal" id="btn_invite_vendors" class="btn green" onclick="FetchVenderNotInvited()">
                                            Invite Vendors
                                        </a>

                                        <button type="button" class="btn red" id="cancl_btn" onclick="cancelBtnclick()">
                                            Cancel Bid
                                        </button>
                                        <button id="btnback" type="button" class="btn yellow" onclick="backButtonClick()">
                                            Back
                                        </button>

                                        <label></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="page-footer">
        <div class="page-footer-inner">
            2016 &copy; <a href="http://www.agileapt.com" target="_blank">AgileApt Solutions Pvt. Ltd.</a>
        </div>
        <div class="scroll-to-top">
            <i class="icon-arrow-up"></i>
        </div>
        <div id="HelpModal" class="modal fade bs-modal-lg in" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-reorder"></i>Help
                        </div>
                        <div class="tools">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        </div>
                    </div>
                    <div class="portlet-body form">

                        <div class="modal-body" style="height: 200px;  overflow-y: scroll;">
                            <h4 class="ppolicy-head4">  Bid Summary  </h4>
                            <p class="ppolicy-text display-none" id="Air">
                                All vendor's Quote will be displayed in "Bid Summary" filed.<br />
                                Admin select the vendor name from drop down list with most feasible quote and click "Submit"<br />
                                Admin can also Export list of all vendors in Excel format OR can cancel the bid as well.	<br />
                            </p>
                            <p class="ppolicy-text display-none" id="Demostic">
                                All vendor's Quote will be displayed in "Bid Summary" filed.<br />
                                Admin select the vendor name from drop down list with most feasible quote and click "Submit"<br />
                                Admin can also Export list of all vendors in Excel format OR can cancel the bid as well<br />
                            </p>
                            <p class="ppolicy-text display-none" id="product">
                                Approver select appropriate vendor.<br />
                                Approver need to Approve / Reject the bid and click on Submit<br />
                                Approver Export list of all vendors in Excel format OR can cancel the bid as well.<br />
                            </p>
                            <p class="ppolicy-text display-none" id="Warehouse">
                                All vendor's Quote will be displayed in "Bid Summary" filed.<br />
                                Admin select the vendor name from drop down list with most feasible quote and click "Submit"<br />
                                Admin can also Export list of all vendors in Excel format OR can cancel the bid as well<br />
                            </p>
                            <p class="ppolicy-text display-none" id="Sea">
                                All vendor's Quote will be displayed in "Bid Summary" filed.<br />
                                Admin select the vendor name from drop down list with most feasible quote and click "Submit"<br />
                                Admin can also Export list of all vendors in Excel format OR can cancel the bid as well.	<br />
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="inviteVendorModal" class="modal fade in bs-modal-lg " tabindex="-1" aria-hidden="true" data-width="400">
            <div class="modal-dialog modal-lg">

                <div class="row">
                    <div class="col-md-12">
                        <div class="modal-content">

                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                <h4 class="modal-title">
                                    <i class="fa fa-reorder"></i> Invite Vendor
                                </h4>

                            </div>

                            <div class="modal-body">
                                <div class="alert alert-success" style='display: none;'>
                                    <span id="spansuccess1"> </span>
                                </div>
                                <div class="alert alert-danger" style='display: none; '>
                                    <span id="spandanger"> </span>
                                </div>
                              
                                    <div class="input-icon">
                                        <i class="fa fa-search"></i>
                                        <input type="text" id="search" placeholder="Search..." class="form-control" />
                                    </div>
                              
                                <div class="scroller" style="height: 250px;" data-always-visible="1" data-rail-visible="0">
                                    <table id="tblvendorlist" class="table table-bordered table-striped table-condensed flip-content">
                                        <thead class="flip-content">
                                            <tr>
                                                <th width="20%">
                                                    <div class="col-md-10 checkbox-list">
                                                        <label class="checkbox-inline" style="margin-left: -16px;">
                                                            <input type="checkbox" id="chkAll" value="Select All" name="chkAll" />&nbsp;All
                                                        </label>
                                                    </div>
                                                </th>
                                                <th width="100%">
                                                    Vendors
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer" style="padding: 10px !important;">
                                <button type="button" class="btn green" onclick="invitevendors()">Invite Vendors</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END CONTENT -->
        </div>
        <div id="graphModalLine" class="modal fade bs-modal-lg in" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-reorder"></i>Bidding Trend
                            <span class="badge badge-danger" id="tmleft"></span>
                        </div>
                        <div class="tools">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-striped table-bordered table-hover" id="tblForTrendGraphs" ></table>
                            </div>
                            <div class="col-md-6">
                                <div id="linechart_material" ></div><br />
                                                                  
                                                                       
                                                                            <label class="col-md-4">
                                                                                <b>  Bid Start Time:</b>
                                                                            </label>
                                                                            <label class="col-md-8 control-label" id="lblbidstarttime">
                                                                            </label>
                                                                       
                                                                            <label class="col-md-4 control-label">
                                                                                <b>  Bid End Time:</b>
                                                                            </label>
                                                                            <label class="col-md-8 control-label" id="lblbidendtime">
                                                                            </label>
                                                                       
                                                                  
                            </div>
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>

        <script src="assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js"
                type="text/javascript"></script>
        
        <script src="assets/global/plugins/highcharts/js/highcharts.js" type="text/javascript"></script>
        <script src="assets/global/plugins/highcharts/js/modules/exporting.js"></script>
        
       
        <script src="assets/global/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js" type="text/javascript"></script>


        <script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
        <script src="assets/plugins/jquery.blockui.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
        <script src="assets/global/plugins/bootstrap-toastr/toastr.min.js"></script>
        <script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
        
        
        <!-- END CORE PLUGINS -->
       
        <script src="assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="assets/global/plugins/jquery-validation/js/jquery.validate.min.js"></script>
        <script src="assets/admin/pages/scripts/ui-alert-dialog-api.js"></script>
        <!-- BEGIN PAGE LEVEL SCRIPTS -->
        <script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
        <script src="assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
        <script src="assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
        <script src="assets/admin/pages/scripts/index.js" type="text/javascript"></script>
        <script src="assets/scripts/aes.js"></script>
        <script src="assets/CustomJS/TypeaHead.js"></script>
        <script src="assets/CustomJS/Auction.js"></script>
        <script src="assets/CustomJS/BidVendorSummary.js"></script>
        <script src="assets/CustomJS/BidVendorSummarySea.js" type="text/javascript"></script>

        <script src="assets/CustomJS/jspdf.debug.js"></script>
        <script src="assets/CustomJS/html2canvas.js"></script>

        <script type="text/javascript">

        </script>
        <!-- END PAGE LEVEL SCRIPTS -->
        <script>

            jQuery(document).ready(function () {
               // $('[data-toggle="popover"]').popover({})
                Pageloaded()
                var param = getUrlVars()["param"];
                var decryptedstring = fndecrypt(param);
               
                jQuery('#btnExportToExcel').click(function () {
                    if (getUrlVarsURL(decryptedstring)["BidTypeID"] == "2") {
                        tableToExcel(['tbldetails', 'tblprice', 'tblBidSummary', 'tblapprovalprocess'], ['BidDetails', 'Price', 'Bid Summary', 'Approval History'], 'BidSummary.xls')
                    }
                    else {
                        tableToExcel(['tbldetails', 'tblBidSummary', 'tblapprovalprocess'], ['BidDetails', 'Bid Summary', 'Approval History'], 'BidSummary.xls')
                     
                    }
                });

                setInterval(function () {
                    Pageloaded()
                    $('[data-toggle="popover"]').popover({})
                }, 15000);
                if (sessionStorage.getItem('UserID') == null || sessionStorage.getItem('UserID') == "") {
                    window.location = sessionStorage.getItem('MainUrl');
                }
                else {
                    if (sessionStorage.getItem("UserType") == "E") {
                        $('.page-container').show();
                    }
                    else {
                        bootbox.alert("You are not Authorize to view this page", function () {
                            parent.history.back();
                            return false;
                        });
                    }
                }
                Metronic.init(); Layout.init(); QuickSidebar.init();
                //fetchBidDetails();
                setCommonData();
               
                FetchRecomendedVendor(getUrlVarsURL(decryptedstring)["BidID"])


            });
        </script>
        <script type="text/javascript">
           
            var tableToExcel = (function () {
                var uri = 'data:application/vnd.ms-excel;base64,'
        , tmplWorkbookXML = '<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'
          + '<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Author>Axel Richter</Author><Created>{created}</Created></DocumentProperties>'
          + '<Styles>'
          + '<Style ss:ID="Currency"><NumberFormat ss:Format="Currency"></NumberFormat></Style>'
          + '<Style ss:ID="Date"><NumberFormat ss:Format="Medium Date"></NumberFormat></Style>'
          + '</Styles>'
          + '{worksheets}</Workbook>'
        , tmplWorksheetXML = '<Worksheet ss:Name="{nameWS}"><Table>{rows}</Table></Worksheet>'
        , tmplCellXML = '<Cell{attributeStyleID}{attributeFormula}><Data ss:Type="{nameType}">{data}</Data></Cell>'
        , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
        , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
                return function (tables, wsnames, wbname, appname) {
                    var ctx = "";
                    var workbookXML = "";
                    var worksheetsXML = "";
                    var rowsXML = "";

                    for (var i = 0; i < tables.length; i++) {
                        if (!tables[i].nodeType) tables[i] = document.getElementById(tables[i]);
                        for (var j = 0; j < tables[i].rows.length; j++) {
                            rowsXML += '<Row>'
                            for (var k = 0; k < tables[i].rows[j].cells.length; k++) {
                                var dataType = tables[i].rows[j].cells[k].getAttribute("data-type");
                                var dataStyle = tables[i].rows[j].cells[k].getAttribute("data-style");
                                var dataValue = tables[i].rows[j].cells[k].getAttribute("data-value");
                                dataValue = (dataValue) ? dataValue : tables[i].rows[j].cells[k].innerHTML;
                                var dataFormula = tables[i].rows[j].cells[k].getAttribute("data-formula");
                                dataFormula = (dataFormula) ? dataFormula : (appname == 'Calc' && dataType == 'DateTime') ? dataValue : null;
                                ctx = {
                                    attributeStyleID: (dataStyle == 'Currency' || dataStyle == 'Date') ? ' ss:StyleID="' + dataStyle + '"' : ''
                       , nameType: (dataType == 'Number' || dataType == 'DateTime' || dataType == 'Boolean' || dataType == 'Error') ? dataType : 'String'
                       , data: (dataFormula) ? '' : dataValue
                       , attributeFormula: (dataFormula) ? ' ss:Formula="' + dataFormula + '"' : ''
                                };
                                rowsXML += format(tmplCellXML, ctx);
                            }
                            rowsXML += '</Row>'
                        }
                        ctx = { rows: rowsXML, nameWS: wsnames[i] || 'Sheet' + i };
                        worksheetsXML += format(tmplWorksheetXML, ctx);
                        rowsXML = "";
                    }

                    ctx = { created: (new Date()).getTime(), worksheets: worksheetsXML };
                    workbookXML = format(tmplWorkbookXML, ctx);



                    var link = document.createElement("A");
                    link.href = uri + base64(workbookXML);
                    link.download = wbname || 'Workbook.xls';
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                   
                }
            })();

 </script>
       
</body>
<!-- END BODY -->
</html>
